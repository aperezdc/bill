<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Simple HTTP server</title>
<meta name="author" content="Adrian Perez &lt;aperez&#64;igalia.com&gt;" />
<meta name="copyright" content="2008 Igalia S.L." />
<link rel="stylesheet" href="../../style.css" type="text/css" />
</head>
<body>
<div class="document" id="simple-http-server">
<h1 class="title">Simple HTTP server</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Adrian Perez &lt;<a class="reference external" href="mailto:aperez&#64;igalia.com">aperez&#64;igalia.com</a>&gt;</td></tr>
<tr class="field"><th class="docinfo-name">License:</th><td class="field-body">GPL v2</td>
</tr>
<tr><th class="docinfo-name">Copyright:</th>
<td>2008 Igalia S.L.</td></tr>
</tbody>
</table>
<div class="abstract topic">
<p class="topic-title first">Abstract</p>
<p>Provides a not-so-basic standalone web server.
Socket functionality is <strong>not</strong> provided. Requests are
read from standard input, responses are sent to standard
output and logging is done the standard error stream.</p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#running-a-webserver" id="id4">Running a webserver</a><ul>
<li><a class="reference internal" href="#using-auxiliar-tools" id="id5">Using auxiliar tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functions" id="id6">Functions</a><ul>
<li><a class="reference internal" href="#http-response-by-code" id="id7">http_response_by_code</a></li>
<li><a class="reference internal" href="#http-mimetype-guess" id="id8">http_mimetype_guess</a></li>
<li><a class="reference internal" href="#http-error-document" id="id9">http_error_document</a></li>
<li><a class="reference internal" href="#http-header" id="id10">http_header</a></li>
<li><a class="reference internal" href="#http-header-start" id="id11">http_header_start</a></li>
<li><a class="reference internal" href="#http-date-now" id="id12">http_date_now</a></li>
<li><a class="reference internal" href="#http-body" id="id13">http_body</a></li>
<li><a class="reference internal" href="#http-error" id="id14">http_error</a></li>
<li><a class="reference internal" href="#http-redirect" id="id15">http_redirect</a></li>
<li><a class="reference internal" href="#http-log-clf" id="id16">http_log_clf</a></li>
<li><a class="reference internal" href="#http-handle-get" id="id17">http_handle_GET</a></li>
<li><a class="reference internal" href="#http-handle-request" id="id18">http_handle_request</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="running-a-webserver">
<h1><a class="toc-backref" href="#id4">Running a webserver</a></h1>
<p>Fortunately, dealing with sockets can be done in pure Bash <a class="footnote-reference" href="#id2" id="id1">[1]</a>.
Unfortunately enough, some distributors choose not to enable support for
this feature. This is the case of the Bash builds included with <a class="reference external" href="http://debian.org">Debian</a>
and <a class="reference external" href="http://ubuntulinux.org">Ubuntu</a>.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://unixjunkie.blogspot.com/2006/01/two-cool-bash-tricks.html">http://unixjunkie.blogspot.com/2006/01/two-cool-bash-tricks.html</a></td></tr>
</tbody>
</table>
<div class="section" id="using-auxiliar-tools">
<h2><a class="toc-backref" href="#id5">Using auxiliar tools</a></h2>
<p>Some utilities exist which allow nearly all program
using the standard input and output streams to use sockets. It is likely
that at least one of these is available for your operating system of
choice. All those examples run a simple web server listening in port
<tt class="docutils literal"><span class="pre">8000</span></tt> at <tt class="docutils literal"><span class="pre">127.0.0.1</span></tt> (the loopback network address). Once you try
one of those command lines, point a browser to <a class="reference external" href="http://localhost:8000/doc">http://localhost:8000/doc</a>
and you will be able of browsing the Bill documentation using the simple
built-in web server.</p>
<table border="1" class="tabular docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Package</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><a class="reference external" href="http://smarden.org/ipsvd/">ipsvd</a></td>
<td><tt class="docutils literal"><span class="pre">tcpsvd</span> <span class="pre">127.0.0.1</span> <span class="pre">8000</span> <span class="pre">./scripts/bill</span> <span class="pre">lib/www/http.bsh</span></tt></td>
</tr>
<tr><td><a class="reference external" href="http://cr.yp.to/ucspi-tcp.html">ucspi-tcp</a></td>
<td><tt class="docutils literal"><span class="pre">tcpserver</span> <span class="pre">-q</span> <span class="pre">127.0.0.1</span> <span class="pre">8000</span> <span class="pre">./scripts/bill</span> <span class="pre">lib/www/http.bsh</span></tt></td>
</tr>
<tr><td><a class="reference external" href="http://netcat.sourceforge.net/">netcat</a></td>
<td><tt class="docutils literal"><span class="pre">(while</span> <span class="pre">true</span> <span class="pre">;</span> <span class="pre">do</span> <span class="pre">nc</span> <span class="pre">-l</span> <span class="pre">-p</span> <span class="pre">8000</span> <span class="pre">-c</span> <span class="pre">'./scripts/bill</span> <span class="pre">lib/www/http.bsh';</span> <span class="pre">done)</span></tt></td>
</tr>
<tr><td><a class="reference external" href="http://web.purplefrog.com/~thoth/netpipes/netpipes.html">netpipes</a></td>
<td><tt class="docutils literal"><span class="pre">faucet</span> <span class="pre">8000</span> <span class="pre">-H</span> <span class="pre">127.0.0.1</span> <span class="pre">-i</span> <span class="pre">-o</span> <span class="pre">./scripts/bill</span> <span class="pre">lib/www/http.bsh</span></tt></td>
</tr>
</tbody>
</table>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Commands should be run from the top-level Bill source
directory, otherwise they may not work.</p>
</div>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <a class="reference external" href="http://netcat.sourceforge.net/">netcat</a> command is very flaky, it will not accept
concurrent connections, and in general will perform poorly.</p>
</div>
</div>
</div>
<div class="section" id="functions">
<h1><a class="toc-backref" href="#id6">Functions</a></h1>
<div class="section" id="http-response-by-code">
<h2><a class="toc-backref" href="#id7">http_response_by_code</a></h2>
<pre class="literal-block">
http_response_by_code code
</pre>
<p>Obtains the descriptive text for the given HTTP response status code.
The strings returned are those specified in the code list contained in
<a class="reference external" href="http://www.ietf.org/rfcs/rfc2068">RFC 2068</a>.</p>
</div>
<div class="section" id="http-mimetype-guess">
<h2><a class="toc-backref" href="#id8">http_mimetype_guess</a></h2>
<pre class="literal-block">
http_mimetype_guess path
</pre>
<p>Determines MIME types depending on the entries of a hash map named
<tt class="docutils literal"><span class="pre">http_mime_mapping</span></tt>, which contains a default set of entries which
suffice for serving the Bill documentation. The suffix of the file
pointed by <tt class="docutils literal"><span class="pre">path</span></tt> is used to determine its content type.</p>
<p>For example:</p>
<div class="highlight"><pre><span class="o">(</span>bill<span class="o">)</span> http_mimetype_guess /etc/sysctl.conf
text/plain
</pre></div>
</div>
<div class="section" id="http-error-document">
<h2><a class="toc-backref" href="#id9">http_error_document</a></h2>
<pre class="literal-block">
http_error_document [ code [ description ... ] ]
</pre>
<p>Generates an error document in standard output:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">code</span></tt> is the HTTP error code (default is <tt class="docutils literal"><span class="pre">500</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">description</span></tt> is an arbitrary piece of text which will be inserted
pre-formatted in the output.</li>
</ul>
</div>
<div class="section" id="http-header">
<h2><a class="toc-backref" href="#id10">http_header</a></h2>
<pre class="literal-block">
http_header name value
</pre>
<p>Sends an HTTP header.</p>
</div>
<div class="section" id="http-header-start">
<h2><a class="toc-backref" href="#id11">http_header_start</a></h2>
<pre class="literal-block">
http_header_start [ code [ description ] ]
</pre>
</div>
<div class="section" id="http-date-now">
<h2><a class="toc-backref" href="#id12">http_date_now</a></h2>
<pre class="literal-block">
http_date_now
</pre>
<p>Returns the current GMT time in RFC 1123 format, as needed for
response HTTP headers.</p>
</div>
<div class="section" id="http-body">
<h2><a class="toc-backref" href="#id13">http_body</a></h2>
<pre class="literal-block">
http_body
</pre>
<p>Prepares the HTTP connection to send content body.</p>
</div>
<div class="section" id="http-error">
<h2><a class="toc-backref" href="#id14">http_error</a></h2>
<pre class="literal-block">
http_error [ code [ description ... ] ]
</pre>
<p>Sends an HTTP error status code and an accompanying HTML document
explaining the error. Error document is formatted using
<a class="reference internal" href="#http-error-document">http_error_document</a>.</p>
</div>
<div class="section" id="http-redirect">
<h2><a class="toc-backref" href="#id15">http_redirect</a></h2>
<pre class="literal-block">
http_redirect uri [ code ]
</pre>
<p>Sends an HTTP redirection, to the given <tt class="docutils literal"><span class="pre">uri</span></tt>. If not supplied, the
<tt class="docutils literal"><span class="pre">code</span></tt> will be <tt class="docutils literal"><span class="pre">302</span></tt> (a permanent redirect). You can pass <tt class="docutils literal"><span class="pre">301</span></tt>
for temporary redirects. Keep in mind that using absolute paths in
redirects is recommended.</p>
</div>
<div class="section" id="http-log-clf">
<h2><a class="toc-backref" href="#id16">http_log_clf</a></h2>
<pre class="literal-block">
http_log_clf [ status ]
</pre>
<p>Logs a line of output to standard error in <a class="reference external" href="http://en.wikipedia.org/wiki/Common_Log_Format">CLF</a> format:</p>
<pre class="literal-block">
host ident authuser date request status bytes
</pre>
<p>Note that the “ident” field will always be empty. The field
“address” will be empty when the remote IP cannot be guessed.
The field “bytes” will be empty as well unless the
<tt class="docutils literal"><span class="pre">Content-Length</span></tt> is set with <a class="reference internal" href="#http-header">http_header</a>.</p>
</div>
<div class="section" id="http-handle-get">
<h2><a class="toc-backref" href="#id17">http_handle_GET</a></h2>
<pre class="literal-block">
http_handle_GET
</pre>
<p>Default handler for the HTTP <tt class="docutils literal"><span class="pre">GET</span></tt> method. This does nothing more than
serving static files and producing directory listings. Also, if path
resolves to a directory which contains a file named <tt class="docutils literal"><span class="pre">index.html</span></tt> it
will be served instead.</p>
</div>
<div class="section" id="http-handle-request">
<h2><a class="toc-backref" href="#id18">http_handle_request</a></h2>
<pre class="literal-block">
http_handle_request [ handler_prefix ]
</pre>
<p>Serves a single HTTP request. The following variables are set by the
function and their values <strong>will be clamped</strong> if already defined. Note
that most of them start with the <tt class="docutils literal"><span class="pre">HTTP_</span></tt> prefix or have names of the
variables used by the <a class="reference external" href="http://www.w3.org/CGI/">CGI interface</a>:</p>
<ul class="simple">
<li>REQUEST_METHOD</li>
<li>PATH_INFO</li>
<li>QUERY_STRING</li>
<li>...and so on.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">handler_prefix</span></tt> can be used to change behavior of how requests
are served. It is used to find which functions are used to serve the
different HTTP methods. As an example, one could define:</p>
<div class="highlight"><pre>my_handler_GET <span class="o">()</span> <span class="o">{</span>
    <span class="c"># Do something interesting...</span>
<span class="o">}</span>
my_handler_HEAD <span class="o">()</span> <span class="o">{</span>
    <span class="c"># ...and something *even* more interesting.</span>
<span class="o">}</span>
</pre></div>
<p>and then use <tt class="docutils literal"><span class="pre">my_handler</span></tt> as prefix, then the HTTP request hadler will
pass <tt class="docutils literal"><span class="pre">GET</span></tt> to <tt class="docutils literal"><span class="pre">my_handler_GET</span></tt> and <tt class="docutils literal"><span class="pre">HEAD</span></tt> ones to
<tt class="docutils literal"><span class="pre">my_handler_HEAD</span></tt>. This allows for easily reusing the HTTP module.</p>
</div>
</div>
</div>
</body>
</html>
